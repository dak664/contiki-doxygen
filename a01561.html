<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Contiki 2.5: Architecture specific functionality for the ELF loader.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Architecture specific functionality for the ELF loader.<br/>
<small>
[<a class="el" href="a01562.html">The Contiki ELF loader</a>]</small>
</h1>
<p>The architecture specific functionality for the Contiki ELF loader has to be implemented for each processor type Contiki runs on.  
<a href="#_details">More...</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Files</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">file &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00233.html">elfloader-arch.h</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>Header file for the architecture specific parts of the Contiki ELF loader. </p>
<br/></td></tr>
</p>
<tr><td class="memItemLeft" align="right" valign="top">file &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00567.html">elfloader-arch-otf.h</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>Header file for the architecture specific parts of the Contiki ELF loader. </p>
<br/></td></tr>
</p>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01561.html#ga1583b48c655f508d845d1a22bd54d2a3">elfloader_arch_allocate_ram</a> (int size)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocate RAM for a new module.  <a href="#ga1583b48c655f508d845d1a22bd54d2a3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01561.html#gabf03ff0788cfecc08e82ec0fc3bff6f7">elfloader_arch_allocate_rom</a> (int size)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocate program memory for a new module.  <a href="#gabf03ff0788cfecc08e82ec0fc3bff6f7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01561.html#gab20475a2c29caa2906b860368895944b">elfloader_arch_relocate</a> (int fd, unsigned int sectionoffset, char *sectionaddr, struct elf32_rela *rela, char *addr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Perform a relocation.  <a href="#gab20475a2c29caa2906b860368895944b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01561.html#ga83a40c77924d5791d8ec67f3465a99de">elfloader_arch_write_rom</a> (int fd, unsigned short textoff, unsigned int size, char *mem)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write to read-only memory (for example the text segment).  <a href="#ga83a40c77924d5791d8ec67f3465a99de"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01561.html#ga910cf34ca87a7c3440be13468a1ee920">elfloader_arch_relocate</a> (int input_fd, struct <a class="el" href="a00041.html">elfloader_output</a> *output, unsigned int sectionoffset, char *sectionaddr, struct elf32_rela *rela, char *addr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Perform a relocation.  <a href="#ga910cf34ca87a7c3440be13468a1ee920"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>The architecture specific functionality for the Contiki ELF loader has to be implemented for each processor type Contiki runs on. </p>
<p>Since the ELF format is slightly different for different processor types, the Contiki ELF loader is divided into two parts: the generic ELF loader module (<a class="el" href="a01562.html">The Contiki ELF loader</a>) and the architecture specific part (this module). The architecture specific part deals with memory allocation, code and data relocation, and writing the relocated ELF code into program memory.</p>
<p>To port the Contiki ELF loader to a new processor type, this module has to be implemented for the new processor type. </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga1583b48c655f508d845d1a22bd54d2a3"></a><!-- doxytag: member="elfloader&#45;arch.h::elfloader_arch_allocate_ram" ref="ga1583b48c655f508d845d1a22bd54d2a3" args="(int size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* elfloader_arch_allocate_ram </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Allocate RAM for a new module. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>The size of the requested memory. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>A pointer to the allocated RAM</dd></dl>
<p>This function is called from the Contiki ELF loader to allocate RAM for the module to be loaded into.</p>

<p>Definition at line <a class="el" href="a00234_source.html#l00075">75</a> of file <a class="el" href="a00234_source.html">elfloader-avr.c</a>.</p>

<p>References <a class="el" href="a01559.html#ga0fedd76f44b4750a7762f633467e5515">mmem_alloc()</a>, <a class="el" href="a01559.html#ga172798945ec6cf2d23cb7cb7dc76861c">mmem_free()</a>, and <a class="el" href="a00210_source.html#l00076">MMEM_PTR</a>.</p>

<p>Referenced by <a class="el" href="a00238_source.html#l00338">elfloader_load()</a>.</p>

</div>
</div>
<a class="anchor" id="gabf03ff0788cfecc08e82ec0fc3bff6f7"></a><!-- doxytag: member="elfloader&#45;arch.h::elfloader_arch_allocate_rom" ref="gabf03ff0788cfecc08e82ec0fc3bff6f7" args="(int size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* elfloader_arch_allocate_rom </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Allocate program memory for a new module. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>The size of the requested memory. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>A pointer to the allocated program memory</dd></dl>
<p>This function is called from the Contiki ELF loader to allocate program memory (typically ROM) for the module to be loaded into.</p>

<p>Definition at line <a class="el" href="a00234_source.html#l00096">96</a> of file <a class="el" href="a00234_source.html">elfloader-avr.c</a>.</p>

<p>Referenced by <a class="el" href="a00238_source.html#l00338">elfloader_load()</a>.</p>

</div>
</div>
<a class="anchor" id="ga910cf34ca87a7c3440be13468a1ee920"></a><!-- doxytag: member="elfloader&#45;arch&#45;otf.h::elfloader_arch_relocate" ref="ga910cf34ca87a7c3440be13468a1ee920" args="(int input_fd, struct elfloader_output *output, unsigned int sectionoffset, char *sectionaddr, struct elf32_rela *rela, char *addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int elfloader_arch_relocate </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>input_fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00041.html">elfloader_output</a> *&nbsp;</td>
          <td class="paramname"> <em>output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>sectionoffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>sectionaddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct elf32_rela *&nbsp;</td>
          <td class="paramname"> <em>rela</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>addr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Perform a relocation. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>output</em>&nbsp;</td><td>The output object for the segment. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sectionoffset</em>&nbsp;</td><td>The file offset at which the relocation can be found. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sectionaddr</em>&nbsp;</td><td>The section start address (absolute runtime). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rela</em>&nbsp;</td><td>A pointer to an ELF32 rela structure (struct elf32_rela). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td>The relocated address.</td></tr>
  </table>
  </dd>
</dl>
<p>This function is called from the Contiki ELF loader to perform a relocation on a piece of code or data. The relocated address is calculated by the Contiki ELF loader, based on information in the ELF file, and it is the responsibility of this function to patch the executable code. The Contiki ELF loader passes a pointer to an ELF32 rela structure (struct elf32_rela) that contains information about how to patch the code. This information is different from processor to processor. </p>

<p>Definition at line <a class="el" href="a00559_source.html#l00022">22</a> of file <a class="el" href="a00559_source.html">elfloader-arm.c</a>.</p>

<p>References <a class="el" href="a00120_source.html#l01044">cfs_seek()</a>, <a class="el" href="a00127_source.html#l00127">CFS_SEEK_SET</a>, <a class="el" href="a00239_source.html#l00083">ELFLOADER_OK</a>, and <a class="el" href="a00569_source.html#l00129">ELFLOADER_UNHANDLED_RELOC</a>.</p>

</div>
</div>
<a class="anchor" id="gab20475a2c29caa2906b860368895944b"></a><!-- doxytag: member="elfloader&#45;arch.h::elfloader_arch_relocate" ref="gab20475a2c29caa2906b860368895944b" args="(int fd, unsigned int sectionoffset, char *sectionaddr, struct elf32_rela *rela, char *addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void elfloader_arch_relocate </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>sectionoffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>sectionaddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct elf32_rela *&nbsp;</td>
          <td class="paramname"> <em>rela</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>addr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Perform a relocation. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fd</em>&nbsp;</td><td>The file descriptor for the ELF file. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sectionoffset</em>&nbsp;</td><td>The file offset at which the relocation can be found. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sectionaddr</em>&nbsp;</td><td>The section start address (absolute runtime). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rela</em>&nbsp;</td><td>A pointer to an ELF32 rela structure (struct elf32_rela). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td>The relocated address.</td></tr>
  </table>
  </dd>
</dl>
<p>This function is called from the Contiki ELF loader to perform a relocation on a piece of code or data. The relocated address is calculated by the Contiki ELF loader, based on information in the ELF file, and it is the responsibility of this function to patch the executable code. The Contiki ELF loader passes a pointer to an ELF32 rela structure (struct elf32_rela) that contains information about how to patch the code. This information is different from processor to processor. </p>

<p>Definition at line <a class="el" href="a00234_source.html#l00177">177</a> of file <a class="el" href="a00234_source.html">elfloader-avr.c</a>.</p>

<p>References <a class="el" href="a00120_source.html#l01044">cfs_seek()</a>, <a class="el" href="a00127_source.html#l00136">CFS_SEEK_CUR</a>, <a class="el" href="a00127_source.html#l00127">CFS_SEEK_SET</a>, and <a class="el" href="a00569_source.html#l00129">ELFLOADER_UNHANDLED_RELOC</a>.</p>

</div>
</div>
<a class="anchor" id="ga83a40c77924d5791d8ec67f3465a99de"></a><!-- doxytag: member="elfloader&#45;arch.h::elfloader_arch_write_rom" ref="ga83a40c77924d5791d8ec67f3465a99de" args="(int fd, unsigned short textoff, unsigned int size, char *mem)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void elfloader_arch_write_rom </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short&nbsp;</td>
          <td class="paramname"> <em>textoff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>mem</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Write to read-only memory (for example the text segment). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fd</em>&nbsp;</td><td>The file descriptor for the ELF file. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>textoff</em>&nbsp;</td><td>Offset of text segment relative start of file. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>The size of the text segment. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mem</em>&nbsp;</td><td>A pointer to the where the text segment should be flashed</td></tr>
  </table>
  </dd>
</dl>
<p>This function is called from the Contiki ELF loader to write the program code (text segment) of a loaded module into memory. The function is called when all relocations have been performed. </p>

<p>Definition at line <a class="el" href="a00234_source.html#l00116">116</a> of file <a class="el" href="a00234_source.html">elfloader-avr.c</a>.</p>

<p>References <a class="el" href="a00120_source.html#l01044">cfs_seek()</a>, <a class="el" href="a00127_source.html#l00127">CFS_SEEK_SET</a>, <a class="el" href="a00663_source.html#l00096">flash_clear()</a>, <a class="el" href="a00663_source.html#l00086">flash_done()</a>, <a class="el" href="a00663_source.html#l00058">flash_setup()</a>, and <a class="el" href="a00663_source.html#l00108">flash_write()</a>.</p>

<p>Referenced by <a class="el" href="a00238_source.html#l00338">elfloader_load()</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Mon Apr 11 14:23:51 2011 for Contiki 2.5 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
